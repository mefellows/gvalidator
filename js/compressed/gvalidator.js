if(typeof(ONEGEEK)=="undefined"){ONEGEEK={};}if(typeof ONEGEEK.forms=="undefined"){ONEGEEK.forms={FIELD_STATUS_RESET:0,FIELD_STATUS_ERROR:1,FIELD_STATUS_OK:2,FIELD_STATUS_INFO:3,FIELD_STATUS_NONE:4,FIELD_STATUS_EMPTY:5};}Function.prototype.gbind=function(b,a){var c=this;return function(){return c.apply(b,a);};};if(typeof(Array.prototype.inArray)=="undefined"){Array.prototype.inArray=function(a){for(key in this){if(this[key]===a){return true;}}return false;};}ONEGEEK.forms.DOMUtilities=function(){this.findPos=function(obj){var curleft=0;var curtop=0;if(obj.offsetParent){do{curleft+=obj.offsetLeft;curtop+=obj.offsetTop;}while((obj=obj.offsetParent));}return[curleft,curtop];};this.togglePopup=function(source,target){var div=target;var coords=this.findPos(source);if(!this.hasClass(div,"hidden")){this.addClass(div,"hidden");}else{div.style.position="absolute";div.style.left=coords[0]+10+"px";div.style.top=coords[1]-6+"px";this.removeClass(div,"hidden");}};this.hasClass=function(element,className){var classes=element.className;var pattern=new RegExp(className,"g");if(pattern.test(classes)){return true;}return false;};this.removeClass=function(element,className){var classes=element.className;var regex="\b"+className+"\b";element.className=classes.replace(className,"");};this.addClass=function(element,className){var classes=element.className;if(!this.hasClass(element,className)){element.className+=" "+className;}};this.addEvent=function(element,event,handler){if(element.attachEvent){element.attachEvent("on"+event,handler);}else{if(element.addEventListener){element.addEventListener(event,handler,false);}else{if(!element.id){var date=new Date();element.id=date.getTime();}eval("document.getElementById("+element.id+").on"+event+"="+handler);}}};};var _du=new ONEGEEK.forms.DOMUtilities();ONEGEEK.forms.AbstractFormField=function(c){this.field=c||null;this.successMsg="Completed";this.errorMsg="Please complete";this.contextMsg="Please complete";this.emptyMsg="%field% is required, please complete";this.msgSpan=null;this.isRequired=false;this.statusImg=null;this.statusLink=null;this.fieldStatus=null;this.modified=false;this.className=null;var b=["errorMsg","emptyMsg","successMsg","contextMsg","regex","cleanRegex"];this.form=null;this.state=null;this.setOptions=function(d){for(item in d){if(b.inArray(item)===true){this[item]=d[item];}}};this.setClassName=function(d){this.className=d;};this.setLang=function(g){var d=null;try{this.setOptions(ONEGEEK.forms.GValidator.translation[g].defaults);this.setOptions(ONEGEEK.forms.GValidator.translation[g][this.className]);}catch(f){}};this.setup=function(){if(_du.hasClass(this.field,"required")){this.isRequired=true;}this.getMsgSpan();if(this.form.options.eMsgFormat=="compact"){this.createFieldStatusIcon();}this.createRequiredSpan();this.validate();_du.addEvent(this.field,"blur",this.applyFieldValidation(this));_du.addEvent(this.field,"click",this.applyContextInformation(this));_du.addEvent(this.field,"change",this.applyFieldModification(this));this.setLabel();};this.setLabel=function(){try{if(this.field.type!="checkbox"&&this.field.type!="radio"){var k=this.form.getForm().getElementsByTagName("label");for(var f=0;f<k.length;f++){if(k[f].getAttribute("for")==this.field.id){this.label=k[f].innerHTML;return true;}}}var h=this.field.parentNode;var d="";do{d=h.tagName.toLowerCase();if(d=="fieldset"){var g=h.getElementsByTagName("legend");if(g.length>0){this.label=g[0].innerHTML;return true;}}h=h.parentNode;}while(h&&d!="form");}catch(j){this.label="Field";return false;}this.label="Field";return false;};this.setForm=function(d){this.form=d;};this.applyFieldModification=function(d){return function(){d.setModified(true);};};this.applyContextInformation=function(d){return function(){var e=d.getMsgSpan();if(e&&d.getModified()===false&&d.getDOMElement.value===""&&d.getContextMsg()){d.setState(ONEGEEK.forms.FIELD_STATUS_INFO);}};};this.applyFieldValidation=function(d){return function(){d.validate();};};this.setModified=function(d){this.modified=d;};this.getModified=function(){return this.modified;};this.reset=function(){this.setModified(false);this.setState(ONEGEEK.forms.FIELD_STATUS_RESET);};this.setState=function(e){this.state=e;_du.removeClass(this.msgSpan,"error");_du.removeClass(this.msgSpan,"info");_du.removeClass(this.msgSpan,"ok");var h="";var g="";var f="";var d=null;switch(e){case ONEGEEK.forms.FIELD_STATUS_EMPTY:h=this.form.options.icons.error;f="There are errors with this field. Click for more info.";g="There are errors with this field. Click for more info.";this.emptyMsg=this.emptyMsg.replace("%field%","'"+this.label+"'");d=this.emptyMsg;_du.addClass(this.msgSpan,"error");break;case ONEGEEK.forms.FIELD_STATUS_ERROR:h=this.form.options.icons.error;f="There are errors with this field. Click for more info.";g="There are errors with this field. Click for more info.";d=this.errorMsg;_du.addClass(this.msgSpan,"error");break;case ONEGEEK.forms.FIELD_STATUS_OK:h=this.form.options.icons.ok;f="This field has been completed successfully.";g="This field has been completed successfully.";d=this.successMsg;_du.addClass(this.msgSpan,"ok");break;case ONEGEEK.forms.FIELD_STATUS_RESET:if(this.form.options.eMsgFormat=="compact"){_du.addClass(this.msgSpan,"hidden");}default:h=this.form.options.icons.info;f="Click for more information about this field.";g="Click for more information about this field.";d=this.contextMsg;_du.addClass(this.msgSpan,"info");}if(this.form.options.eMsgFormat=="compact"){this.statusImg.src=h;this.statusImg.alt=f;this.statusImg.title=g;}if(d!==null){this.msgSpan.innerHTML=d;}else{_du.addClass(this.msgSpan,"hidden");}};this.createRequiredSpan=function(){if(this.form.options.reqShow){var d=document.createElement("span");d.className="required";if(this.isRequired){d.innerHTML=this.form.options.reqChar;}else{d.innerHTML=" &nbsp;";}if(this.form.options.reqPlacement=="before"){this.field.parentNode.insertBefore(d,this.field.parentNode.firstChild);}else{this.field.parentNode.insertBefore(d,this.field);}}};this.createFieldStatusIcon=function(){if(this.fieldStatus===null){var f=this.field.parentNode.getElementsByTagName("span");for(var d=0;d<f.length;d++){if(_du.hasClass(f[d],"fieldstatus")){this.fieldStatus=f[d];return this.fieldStatus;}}var e=document.createElement("span");e.className="fieldstatus";this.statusImg=document.createElement("img");this.statusImg.src=this.form.options.icons.info;this.statusLink=document.createElement("a");_du.addEvent(this.statusLink,this.form.options.eMsgEventOn,a(this.statusLink,this.msgSpan));if(this.form.options.eMsgEventOff!==null){_du.addEvent(this.statusLink,this.form.options.eMsgEventOff,a(this.statusLink,this.msgSpan));}this.statusLink.appendChild(this.statusImg);e.appendChild(this.statusLink);this.fieldStatus=this.field.parentNode.insertBefore(e,this.getMsgSpan());return this.fieldStatus;}else{return this.fieldStatus;}};var a=function(e,d){return function(){_du.togglePopup(e,d);};};this.getMsgSpan=function(){if(this.msgSpan===null){var f=this.field.parentNode.getElementsByTagName("span");for(var d=0;d<f.length;d++){if(_du.hasClass(f[d],"msg")){this.msgSpan=f[d];return this.msgSpan;}}var e=document.createElement("span");if(this.form.options.eMsgFormat=="compact"){e.className="msg hidden info";}else{e.className="msg icon info";}e.innerHTML=this.contextMsg;this.msgSpan=this.field.parentNode.appendChild(e);}return this.msgSpan;};this.validate=function(){if(this.field.value){this.setState(ONEGEEK.forms.FIELD_STATUS_OK);return true;}if(this.modified===false){this.setState(ONEGEEK.forms.FIELD_STATUS_INFO);}else{this.setState(ONEGEEK.forms.FIELD_STATUS_EMPTY);}return false;};this.clean=function(){};this.getDOMElement=function(){return this.field;};this.setDOMElement=function(d){this.field=c;};this.getContextMsg=function(){return this.contextMsg;};this.getErrorMsg=function(){return this.errorMsg;};this.getSuccessMsg=function(){return this.successMsg;};this.isRequiredField=function(){return this.isRequired;};};ONEGEEK.forms.FormFieldFactory=function(){var a=new Array();this.lookupFormField=function(b,d){if(a[b]!=null){var c=new (window.ONEGEEK.forms[a[b]["class"]])(d);c.setOptions(a[b].options);return c;}return null;};this.registerFormField=function(d,c,b){if(a[d]!=null){alert("FormFieldFactory registerFormField(): Cannot register field ("+d+"), as this namespace is in use");return;}a[d]={"class":c,options:b};};};var formFieldFactory=new ONEGEEK.forms.FormFieldFactory();ONEGEEK.forms.AbstractComboBox=function(a){this.field=a;this.validate=function(){if(this.field.value&&this.field.value!==""){this.setState(ONEGEEK.forms.FIELD_STATUS_OK);return true;}if(this.modified===false||!this.isRequired){this.setState(ONEGEEK.forms.FIELD_STATUS_INFO);}else{this.setState(ONEGEEK.forms.FIELD_STATUS_EMPTY);}return false;};this.setup=function(){if(_du.hasClass(this.field,"required")){this.isRequired=true;}this.getMsgSpan();if(this.form.options.eMsgFormat=="compact"){this.createFieldStatusIcon();}this.createRequiredSpan();this.validate();_du.addEvent(this.field,"click",this.applyFieldValidation(this));_du.addEvent(this.field,"blur",this.applyFieldValidation(this));_du.addEvent(this.field,"click",this.applyContextInformation(this));_du.addEvent(this.field,"change",this.applyFieldModification(this));this.setLabel();};};ONEGEEK.forms.AbstractComboBox.prototype=new ONEGEEK.forms.AbstractFormField();formFieldFactory.registerFormField("select","AbstractComboBox");formFieldFactory.registerFormField("combo","AbstractComboBox");ONEGEEK.forms.AbstractCheckbox=function(a){this.field=a;this.clean=function(){};this.validate=function(){var b=document.forms[0].elements[this.field.name];for(i=0;i<b.length;i++){if(b[i].checked){this.setState(ONEGEEK.forms.FIELD_STATUS_OK);return true;}else{if(this.modified!==true||!this.isRequired){this.setState(ONEGEEK.forms.FIELD_STATUS_INFO);}else{this.setState(ONEGEEK.forms.FIELD_STATUS_EMPTY);}}}return false;};this.setup=function(){if(_du.hasClass(this.field,"required")){this.isRequired=true;}this.getMsgSpan();if(this.form.options.eMsgFormat=="compact"){this.createFieldStatusIcon();}this.createRequiredSpan();this.validate();var b=document.forms[0].elements[this.field.name];for(i=0;i<b.length;i++){_du.addEvent(b[i],"click",this.applyFieldValidation(this));_du.addEvent(b[i],"click",this.applyContextInformation(this));_du.addEvent(b[i],"change",this.applyFieldModification(this));}this.setLabel();};};ONEGEEK.forms.AbstractCheckbox.prototype=new ONEGEEK.forms.AbstractFormField();formFieldFactory.registerFormField("checkbox","AbstractCheckbox");ONEGEEK.forms.AbstractRadioButton=function(a){this.field=a;this.clean=function(){};this.setup=function(){if(_du.hasClass(this.field,"required")){this.isRequired=true;}this.getMsgSpan();if(this.form.options.eMsgFormat=="compact"){this.createFieldStatusIcon();}this.createRequiredSpan();this.validate();var b=document.forms[0].elements[this.field.name];for(i=0;i<b.length;i++){_du.addEvent(b[i],"click",this.applyFieldValidation(this));_du.addEvent(b[i],"click",this.applyContextInformation(this));_du.addEvent(b[i],"change",this.applyFieldModification(this));}this.setLabel();};this.validate=function(){var b=document.forms[0].elements[this.field.name];for(i=0;i<b.length;i++){if(b[i].checked){this.setState(ONEGEEK.forms.FIELD_STATUS_OK);return true;}else{if(this.modified!==true||!this.isRequired){this.setState(ONEGEEK.forms.FIELD_STATUS_INFO);}else{this.setState(ONEGEEK.forms.FIELD_STATUS_EMPTY);}}}return false;};};ONEGEEK.forms.AbstractRadioButton.prototype=new ONEGEEK.forms.AbstractFormField();formFieldFactory.registerFormField("radio","AbstractRadioButton");ONEGEEK.forms.AbstractTextField=function(a){this.field=a;this.regex="";this.cleanRegex="";this.pattern=null;this.validate=function(){if(this.field.value){this.clean();this.pattern=new RegExp(this.regex);var b=this.pattern.test(this.field.value);if(b){this.setState(ONEGEEK.forms.FIELD_STATUS_OK);}else{this.setState(ONEGEEK.forms.FIELD_STATUS_ERROR);}return b;}if(this.modified===false||this.isRequired===false){this.setState(ONEGEEK.forms.FIELD_STATUS_INFO);}else{this.setState(ONEGEEK.forms.FIELD_STATUS_EMPTY);}return false;};this.clean=function(){this.field.value=this.field.value.replace(this.cleanRegex,"");};};ONEGEEK.forms.AbstractTextField.prototype=new ONEGEEK.forms.AbstractFormField();ONEGEEK.forms.NameField=function(a){this.field=a;this.regex=/^([a-zA-Z\-\'\s]{2,30})$/g;this.cleanRegex=/[^a-zA-Z\-\'\s]/g;this.errorMsg="Your name must be between 2 and 30 characters";this.contextMsg="We would like to call you by your name";};ONEGEEK.forms.NameField.prototype=new ONEGEEK.forms.AbstractTextField();formFieldFactory.registerFormField("firstname","NameField");formFieldFactory.registerFormField("lastname","NameField");formFieldFactory.registerFormField("name","NameField");ONEGEEK.forms.PhoneField=function(a){this.field=a;this.regex=/^([0-9]{8,10})$/g;this.cleanRegex=/[^0-9]/g;this.errorMsg="Your phone number needs to be at least 8 digits long i.e. 03 1234 5678";this.contextMsg=this.errorMsg;};ONEGEEK.forms.PhoneField.prototype=new ONEGEEK.forms.AbstractTextField();formFieldFactory.registerFormField("phone","PhoneField");ONEGEEK.forms.EmailField=function(a){this.field=a;this.regex=/^[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,4}$/i;this.errorMsg="Please enter a valid email address i.e. user@domain.com";this.contextMsg="Your email address will be kept confidential";this.clean=function(){};};ONEGEEK.forms.EmailField.prototype=new ONEGEEK.forms.AbstractTextField();formFieldFactory.registerFormField("email","EmailField");ONEGEEK.forms.GenericTextField=function(a){this.field=a;this.regex=/^.*$/;this.cleanRegex=/[<>\/\\\(\);]/g;};ONEGEEK.forms.GenericTextField.prototype=new ONEGEEK.forms.AbstractTextField();formFieldFactory.registerFormField("text","GenericTextField");formFieldFactory.registerFormField("generictext","GenericTextField");ONEGEEK.forms.CaptchaTextField=function(a){this.field=a;this.regex=/^([A-Za-z0-9\-_]+)$/g;this.cleanRegex=/[<>\/\\\(\);]/g;this.successMsg="Thankyou...";this.errorMsg="Please complete the security check";this.contextMsg="This prevents us from spam";};ONEGEEK.forms.CaptchaTextField.prototype=new ONEGEEK.forms.AbstractTextField();formFieldFactory.registerFormField("captcha","CaptchaTextField");ONEGEEK.forms.RecaptchaTextField=function(a){this.field=a;this.contextMsg="Need some <a href='javascript:Recaptcha.showhelp()'>help</a>? Get another <a href='javascript:Recaptcha.reload()'>CAPTCHA</a>";};ONEGEEK.forms.RecaptchaTextField.prototype=new ONEGEEK.forms.CaptchaTextField();formFieldFactory.registerFormField("recaptcha_response_field",new ONEGEEK.forms.RecaptchaTextField());formFieldFactory.registerFormField("recaptcha","RecaptchaTextField");ONEGEEK.forms.Form=function(g){var a=new Array();var d=g||document.getElementById(g)||null;var b=false;this.lang=null;this.custom=false;var e=["autoFocus","eMsgEventOn","eMsgEventOff","eMsgFormat","icons","error","info","ok","eMsgFunction","fMsg","fMsgFormat","fMsgContainer","fMsgFunction","reqShow","reqChar","reqPlacement","supressAlert"];this.options={icons:{ok:"../images/icons/tick.png",info:"../images/icons/help.png",error:"../images/icons/icon_alert.gif"},reqShow:true,reqChar:"*",reqPlacement:"after",fMsgFormat:"alert",fMsg:"Please correct the highlighted errors.",eMsgFormat:"open",eMsgEventOn:"click",eMsgEventOff:null,autoFocus:true};this.readOptions=function(f){this.options=this._readOptionsRecursive(this.options,f);};this._readOptionsRecursive=function(h,f){for(var k in f){if(e.inArray(k)){try{if(typeof(f[k])=="object"){h[k]=this._readOptionsRecursive(h[k],f[k]);}else{h[k]=f[k];}}catch(j){h[k]=f[k];}}}return h;};this.setOptions=function(){try{this.readOptions(ONEGEEK.forms.GValidator.options);if(this.custom===true){this.readOptions(ONEGEEK.forms.GValidator.options[d.id]);}}catch(f){}};this.reset=function(){for(var f=0;f<a.length;f++){a[f].reset();}};this.getForm=function(){return d;};this.handleErrors=function(n){if(this.options.supressAlert!==true){alert(this.options.fMsg);}switch(this.options.fMsgFormat){case"container":var k=document.getElementById("gvErrorsList");var m=document.getElementById(this.options.fMsgContainer);var h=document.createElement("ul");h.id="gvErrorsList";for(var j=0;j<n.length;j++){var f=document.createElement("li");if(n[j].state===ONEGEEK.forms.FIELD_STATUS_ERROR){f.innerHTML=n[j].errorMsg;}else{f.innerHTML=n[j].emptyMsg;}h.appendChild(f);}if(k){m.replaceChild(h,k);}else{m.appendChild(h);}_du.removeClass(m,"hidden");window.location="#"+this.options.fMsgContainer;break;case"function":return this.options.fMsgFunction(n);default:break;}return false;};this.validate=function(l){var k=null;var n=[];var m=[];for(var f=0;f<a.length;f++){a[f].setModified(true);var j=a[f].validate();if(!j&&a[f].isRequiredField()){n[n.length]=a[f];m[m.length]=a[f].getDOMElement();}}if(n[0]){m[0].focus();this.handleErrors(n);return false;}var h=d.getElementsByTagName("input");for(f=0;f<h.length;f++){if(h[f].type=="submit"){h[f].setProperty("lastvalue",h[f].value);h[f].disabled=true;h[f].value="Please wait...";}}return true;};this.applyFocus=function(){if(this.options.autoFocus===true){var f=document.getElementsByTagName("input");if(f.length>0){f[0].focus();}}};var c=function(f){var j=null;for(var h=0;h<a.length;h++){if(a[h].getDOMElement().name==f){return a[h].getDOMElement();}}return j;};this.doForm=function(){if(d){this.lang=(d.lang)?d.lang:null;if(_du.hasClass(d,"custom")){this.custom=true;}this.setOptions();var h=d.getElementsByTagName("input");for(var k=0;k<h.length;k++){this.doFormField(h[k]);}var f=d.getElementsByTagName("textarea");for(k=0;k<f.length;k++){this.doFormField(f[k]);}var j=d.getElementsByTagName("select");for(k=0;k<j.length;k++){this.doFormField(j[k]);}d.onsubmit=this.validate.gbind(this);_du.addEvent(d,"reset",this.reset.gbind(this));}};this.doFormField=function(n){if(n&&n.type=="text"||n.type=="password"||n.type=="textarea"||n.type=="select-one"||n.type=="select-multiple"||n.type=="checkbox"||n.type=="file"||n.type=="radio"){if(!c(n.name)){var m=n.className;var k=null;var f=0;if(m.indexOf(" ")>-1){var l=m.split(" ");do{m=l[f];k=formFieldFactory.lookupFormField(m,n);f++;}while(k===null&&f<l.length);}else{k=formFieldFactory.lookupFormField(m,n);}if(k){k.setClassName(m);if(this.lang!==null){k.setLang(this.lang);}var h=k.getDOMElement();k.setForm(this);k.setup();a[a.length]=k;}}}};};ONEGEEK.forms.GValidator=function(){var a=[];this.readPlugins=function(){for(item in ONEGEEK.forms.GValidator.plugins){formFieldFactory.registerFormField(item,ONEGEEK.forms.GValidator.plugins[item]._extends,ONEGEEK.forms.GValidator.plugins[item]);}};this.applyFocus=function(){if(a.length>0){a[0].applyFocus();}};this.autoApplyFormValidation=function(){var b=document.getElementsByTagName("form");for(var c=0;c<b.length;c++){if(_du.hasClass(b[c],"autoform")||_du.hasClass(b[c],"gform")){a[c]=new ONEGEEK.forms.Form(b[c]);a[c].doForm();}}this.applyFocus();};this.readPlugins();};if(typeof(ONEGEEK.forms.GValidator.translation)=="undefined"){ONEGEEK.forms.GValidator.translation={};}function addLoadEventGVal(a){var b=window.onload;if(typeof window.onload!="function"){window.onload=a;}else{window.onload=function(){if(b){b();}a();};}}addLoadEventGVal(function(){gvalidator=new ONEGEEK.forms.GValidator();gvalidator.autoApplyFormValidation();});